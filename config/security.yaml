# Security policy configuration (spec 004)
# ---------------------------------------------------------------------------
# All controls are opt-in with safe defaults.  Flip ``enabled: false`` to
# disable a control without removing the config block.
# ---------------------------------------------------------------------------

mcp_servers:
  verification:
    enabled: true
    require_signature: true
    trusted_sources:
      - https://github.com/anthropics/mcp-servers
      - https://github.com/modelcontextprotocol/

  rate_limiting:
    enabled: true
    limits:
      email:
        per_minute: 10
        per_hour: 100
      payment:
        per_minute: 1
        per_hour: 10
      deploy:
        per_minute: 2
        per_hour: 20

audit:
  log_all_mcp_actions: true
  log_credential_access: true
  alert_on_suspicious: true

secrets:
  scan_enabled: true
  redact_in_logs: true
  patterns:
    - api_key
    - password
    - token
    - secret

# ---------------------------------------------------------------------------
# Circuit Breakers  (Platinum – US12)
# ---------------------------------------------------------------------------
circuit_breakers:
  enabled: true
  failure_threshold: 5           # consecutive failures before OPEN
  failure_window_seconds: 60
  open_timeout_seconds: 30       # seconds in OPEN before HALF_OPEN probe
  success_threshold: 2           # probes needed to close HALF_OPEN

# ---------------------------------------------------------------------------
# Anomaly Detection  (Platinum – US11)
# ---------------------------------------------------------------------------
anomaly_detection:
  enabled: true
  baseline_window_days: 7
  std_deviation_threshold: 2.0
  min_sample_count: 3

# ---------------------------------------------------------------------------
# Notifications / Webhooks  (Platinum – Polish)
# ---------------------------------------------------------------------------
notifications:
  enabled: true
  webhook_url: null              # override via FTE_SECURITY_WEBHOOK_URL
  events:
    - anomaly_detected
    - mcp_isolated
    - credential_rotation
    - circuit_breaker_tripped
    - health_degraded

# ---------------------------------------------------------------------------
# Health-Check Thresholds  (Platinum – Polish)
# ---------------------------------------------------------------------------
health_check:
  max_error_rate: 0.10           # warn when error_rate > 10 %
  max_throttled_buckets: 3       # warn when this many buckets < 10 %
  max_open_circuits: 1           # warn when this many circuits OPEN
  max_unresolved_alerts: 5       # warn when alert backlog exceeds this

# ---------------------------------------------------------------------------
# Credential Vault  (Bronze)
# ---------------------------------------------------------------------------
credential_vault:
  backend: keyring               # keyring | encrypted_file
  rotation_reminder_days: 90

# ---------------------------------------------------------------------------
# Dashboard  (Platinum – US13)
# ---------------------------------------------------------------------------
dashboard:
  refresh_interval: 5            # live-refresh seconds
  max_alerts: 10
