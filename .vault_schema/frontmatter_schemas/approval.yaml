# YAML Frontmatter Schema: Approval
# Used for approval request files in Approvals folder

# Approval metadata
approval_id:
  type: string
  required: true
  description: "Unique approval identifier (e.g., APR-20260205-001)"
  pattern: "^APR-\\d{8}-\\d{3}$"

title:
  type: string
  required: true
  description: "Approval request title"
  max_length: 200

# Related task
task_id:
  type: string
  required: true
  description: "ID of the task requiring approval"
  pattern: "^TASK-\\d{8}-\\d{3}$"

task_path:
  type: string
  required: true
  description: "Path to the task file"

# Approval details
action_type:
  type: string
  required: true
  description: "Type of action requiring approval"
  enum: ["deploy", "production", "delete", "payment", "email", "execute", "remove", "other"]

risk_level:
  type: string
  required: true
  description: "Risk level of the action"
  enum: ["critical", "high", "medium", "low"]

description:
  type: string
  required: true
  description: "Detailed description of what requires approval"

reason:
  type: string
  required: true
  description: "Why approval is required"

# Keywords that triggered
trigger_keywords:
  type: array
  required: false
  description: "Keywords that triggered approval requirement"
  items:
    type: string

# Approval status
status:
  type: string
  required: true
  description: "Current approval status"
  enum: ["pending", "approved", "rejected", "expired"]
  default: "pending"

decision:
  type: string
  required: false
  description: "Approval decision"
  enum: ["approved", "rejected"]

decision_by:
  type: string
  required: false
  description: "Who made the decision (email or username)"

decision_at:
  type: string
  required: false
  format: date-time
  description: "When decision was made"

decision_reason:
  type: string
  required: false
  description: "Reason for approval/rejection decision"
  max_length: 500

# Security nonce
nonce:
  type: string
  required: true
  description: "Security nonce to prevent replay attacks"
  pattern: "^[a-f0-9]{32}$"

# Timestamps
created_at:
  type: string
  required: true
  format: date-time
  description: "When approval request was created"

expires_at:
  type: string
  required: true
  format: date-time
  description: "When approval request expires (typically 24h)"

responded_at:
  type: string
  required: false
  format: date-time
  description: "When human responded"

# Context
requested_by:
  type: string
  required: true
  description: "Component requesting approval (e.g., orchestrator)"
  default: "orchestrator"

priority:
  type: string
  required: false
  description: "Priority of approval request"
  enum: ["urgent", "high", "medium", "low"]
  default: "high"

# Proposed action details
proposed_action:
  type: object
  required: false
  description: "Details of the proposed action"
  properties:
    command:
      type: string
      description: "Command to be executed"
    target:
      type: string
      description: "Target system/resource"
    impact:
      type: string
      description: "Expected impact"
    rollback_plan:
      type: string
      description: "How to rollback if needed"

# Alternatives considered
alternatives:
  type: array
  required: false
  description: "Alternative approaches considered"
  items:
    type: string
